var _MAX_FW_SIZE="0x470000",_MODEL="ZyXEL_kng_ra",_MODEL_URL="http://www.zyxel.ru/keenetic",_LAN="Home",_WAN="ISP",_WAN_VID=2,_LAN_VID=1,_SWITCH="Switch0",_MASTER="WifiMaster0",_STA="WifiMaster0/WifiStation0",_AP=["AccessPoint","GuestWiFi","WifiMaster0/AccessPoint2","WifiMaster0/AccessPoint3"],_MAX_AP=4,_WEBADMIN="_WEBADMIN",_MAX_LINES=300,_DEBUG=0,_REBOOT_TIME=1e5,_ETHER_WAN_PORT="WAN",_ETHER_LAYOUT=[{port:"LAN4",type:"yellow",name:"4"},{port:"LAN3",type:"yellow",name:"3"},{port:"LAN2",type:"yellow",name:"2"},{port:"LAN1",type:"yellow",name:"1"},{port:"WAN",type:"blue",name:"WAN"}];"indexOf"in Array.prototype||(Array.prototype.indexOf=function(find,i){i===undefined&&(i=0),i<0&&(i+=this.length),i<0&&(i=0);for(var n=this.length;i<n;++i)if(i in this&&this[i]===find)return i;return-1}),"forEach"in Array.prototype||(Array.prototype.forEach=function(action,that){for(var i=0,n=this.length;i<n;i++)i in this&&action.call(that,this[i],i,this)}),"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s*\s$/,"")}),String.prototype.entitify=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;")},Number.prototype.entitify=function(){return this},!window.console&&(window.console={log:function(){},info:function(){},error:function(){},warn:function(){}});var Hooks={setInvalid:function(field,message){var f=field;if(f){f.className="invalid",f.__error||(f.__error=document.createElement("span"),f.__error.className="floating error",f.parentNode.insertBefore(f.__error,f.nextSibling)),f.__error.innerHTML=message;var onkeydown_=f.onkeydown,onchange_=f.onchange;return f.onkeydown=f.onchange=function(){this.className="",this.parentNode.removeChild(this.__error),this.__error=null,this.onkeydown=onkeydown_,this.onchange=onchange_},f.focus(),function(){return f.onchange(),_nope_}}return _nope_}},continuer={blinkingCursor:!0,stopped:-1,invoke:function(){continuer.packet&&continuer.packet.proceed(continuer.logger)},schedule:function(logger,parameterSet,timeout){this.packet=new Packet,this.packet.__isContinuer=!0,this.packet.onProgress=this.onProgress,this.packet.handleError=this.handleError,this.packet.handleMessage=this.handleMessage,"onPrompt"in this&&(this.packet.onPrompt=this.onPrompt),"onReboot"in this&&(this.packet.onReboot=this.onReboot),parameterSet==this.stopped?(this.packet.Break(parameterSet),this.stopped=-1):this.packet.Continue(parameterSet),logger&&(this.logger=logger,this.logger.__keep=""),this.running=parameterSet,this.timer=setTimeout(continuer.invoke,timeout)},stop:function(parameterSet){this.stopped=parameterSet},clear:function(){clearTimeout(this.timer),this.running=0,this.logger=0}};function _nope_(){return _nope_}function ajaxSender(req,data,func,obj){this.attempt=0,this.req=req,this.data=data,this.callback=func,this.cb_obj=obj}ajaxSender.prototype={aj:null,send:function(){var ajs=this,aj=this.aj=ajax._object();return aj.onreadystatechange=function(evt){if(aj.readyState==4){var st=aj.status;st>=200&&st<300||st===304?(ajax.setState("online"),ajs.callback.call(ajs.cb_obj,aj,st),ajax._call(ajax._onstop)):this.to=setTimeout(function(){ajax.setState("offline"),ajs.send()},5e3),aj=this.aj=null}},aj.open("POST",this.req,!0),aj.setRequestHeader("If-Modified-Since","Sat, 1 Jan 1996 00:00:00 GMT"),aj.setRequestHeader("Content-Type","application/xml"),aj.send(this.data),++this.attempt,ajax._call(ajax._onstart),this},abort:function(){this.aj&&this.aj.abort(),this.aj=null,ajax._call(ajax._onstop)}};var ajax={_object:function(){if(window.XMLHttpRequest)return(this._object=function(){return new XMLHttpRequest})();var axos=["MSXML2.XMLHTTP.4.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"];for(var ix=0;ix<axos.length;++ix)try{var axo_id=axos[ix],a=new ActiveXObject(axo_id);if(a)return this._object=function(){return new ActiveXObject(axo_id)},a}catch(ex){}return null},_call:function(a){if(a)for(var i=0;i<a.length;++i)a[i].call(this);return this},post:function(req,data,func,obj){return this.aj=(new ajaxSender(req,data,func,obj)).send()},state:"online",setState:function(s){return s==this.state?this:(this.state=s,this._call(this._onnewstate))},onStart:function(f){(this._onstart||(this._onstart=[])).push(f)},onStop:function(f){(this._onstop||(this._onstop=[])).push(f)},onNewState:function(f){(this._onnewstate||(this._onnewstate=[])).push(f)}};ajax.onStart(function(){}),ajax.onStop(function(){"_div"in ajax&&(ajax._div.className="hidden")});function getPopup(location,name,width,height){var popup=window.open(location,name,["width=",width,",height=",height,",left =",(window.screen.availWidth-width)/2,",top=",(window.screen.availHeight-height)/2,",location=no,scrollbars=yes"].join(""));return popup.opener=window,popup.moveTo((window.screen.availWidth-popup.outerWidth)/2,(window.screen.availHeight-popup.outerHeight)/2),popup.focus(),popup}function htmlspecialchars(s){return!s||!s.replace?s:(e=s.replace(/&/g,"&amp;"),e=e.replace(/"/g,"&quot;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e)}function selectNode(root,selector){function matchNode(node,condition){var parts=condition.split(/[@=]/),res=node.tagName==parts[0];if(!res)return!1;switch(parts.length){case 3:return node.getAttribute(parts[1])==parts[2];case 2:var child=node.firstChild;return child&&child.nodeType==3&&child.nodeValue==parts[1]}return!0}var path=selector.split(">"),targets=root.getElementsByTagName(path[path.length-1].split(/[@=]/)[0]);if(targets){var level=path.length-1,i=0,tl=targets.length,current=targets[i];while(i<tl&&level>=0)if(!current||!matchNode(current,path[level]))i++,i<tl&&(current=targets[i],level=path.length-1);else{if(!(level>0))return targets[i];level--,current=current.parentNode}}return undefined}function getNodeValue(root,nodeName){if(!root)return;var node=root.getElementsByTagName(nodeName);if(!node||!node.length||!node[0].firstChild)return;return node[0].firstChild.nodeValue}function getClosest(base,nodeName){nodeName=new RegExp(nodeName.toLowerCase(),"i");for(;base;base=base.parentNode)if(base.nodeName.match(nodeName))break;return base}function invoke(context,fn,p1,p2,p3,p4){if(typeof fn=="function")return fn.call(context,p1,p2,p3,p4)}function defined(variable){return typeof variable!="undefined"}function equals(a,b){if(a==b)return!0;for(var x in a)if(b[x]!=a[x])return!1;for(var x in b)if(a[x]!=b[x])return!1;return!0}function compareFn(){var args=arguments;return function(a,b){for(var i=0;i<args.length;++i)if(a[args[i]]!=b[args[i]])return args[i]in b&&!!b[args[i]]?args[i]in a&&!!a[args[i]]?isNaN(b[args[i]])||isNaN(a[args[i]])?b[args[i]].toString().toLowerCase()>a[args[i]].toString().toLowerCase()?1:-1:b[args[i]]-a[args[i]]:-1:1;return 0}}function narrow(str,length){if(str&&str.length>length){var start=str.slice(0,length/2),end=str.slice(str.length-length/2);return start.lastIndexOf(" ")!=-1&&(start=start.slice(0,start.lastIndexOf(" "))),end.indexOf(" ")!=-1&&(end=end.slice(end.indexOf(" ")+1)),start+" ... "+end}return str}function formatString(str,length){if(typeof str=="undefined")return"";var narrowed=narrow(str,length||15);return narrowed.length!=str.length?['<span title="',str,'">',narrowed,"</span>"].join(""):narrowed}function pad(string,padding){return(padding+string).slice(-padding.length)}function uptime(seconds,daysLabel){var date=new Date(seconds*1e3);return[Math.floor(seconds/86400),daysLabel,[pad(date.getUTCHours(),"00"),pad(date.getUTCMinutes(),"00"),pad(date.getUTCSeconds(),"00")].join(":")].join(" ")}function scale(value,base,multipliers,decimals){if(multipliers.length){var m=value<base?1:Math.min(Math.floor(Math.log(value)/Math.log(base)),multipliers.length),suffix=multipliers[m-1];return[(value/Math.pow(base,m)).toFixed(isNaN(decimals)?2:decimals),suffix].join(" ")}return value}function formatSize(value){if(isNaN(value))return null;if(value<1e3)return[value,l10n(65610+plural_(value),"bytes")].join(" ");var scaled=scale(value,1e3,[l10n(65620,"k"),l10n(65621,"M"),l10n(65622,"G")]);return[scaled,l10n(65610+plural_(scaled.split(".")[0]),"bytes")].join("")}function qsort(a,fn){if(a.length==0)return[];var left=[],right=[],pivot=a[0];for(var i=1;i<a.length;i++)fn(a[i],pivot)?left.push(a[i]):right.push(a[i]);return qsort(left,fn).concat(pivot,qsort(right,fn))}function Clone(what){for(var i in what)typeof what[i]=="object"?this[i]=new Clone(what[i]):this[i]=what[i]}var __id=(new Date).getTime();function FieldValue(e){e.id||(e.id="_ndm_"+__id++),this.get=function(){if(e.length)for(var i=0;i<e.length;++i){if(e[i].nodeName!="OPTION"&&e[i].type!="radio"&&e[i].type!="checkbox")return e[i].value;if(e[i].selected||e[i].checked)return defined(e[i].value)?e[i].value:e[i].text||i}else if(e.nodeName=="INPUT")switch(e.type){case"text":case"textarea":case"password":case"hidden":return e.value;case"checkbox":case"radio":return e.checked?e.value||"on":!1}else{if(defined(e.selected))return e.selected?e.value||"on":!1;if(e instanceof HTMLElement)return e.innerHTML}return undefined},this.set=function(value){var applied=!1;if(e.length)for(var i=0;i<e.length;++i)if(e[i].nodeName=="OPTION"){if(e[i].value==value||e[i].text==value)applied=e[i].selected=!0}else if(e[i].type=="radio"||e[i].type=="checkbox"){if(!defined(value)||e[i].value==value)applied=e[i].checked=!0}else e[i].value=value||"",applied=!0;else e.nodeName=="INPUT"?(applied=!0,e.type=="checkbox"||e.type=="radio"?(e.checked=!defined(value)||value&&value!="off"&&value!="no"&&value!="disabled"&&value!="down"&&value!="0",document.getElementById(e.id)||(e.defaultChecked=e.checked),e.checked&&defined(value)&&(_DEBUG&&console.log('Debug: The value "'+value+'" assigned to checkbox'),e.value=value||"")):defined(e.value)?e.value=value||"":applied=!1):defined(e.selected)?e.selected=value!="off"&&value!="no"&&value!="disabled"&&value!="down":e instanceof HTMLElement&&(e.innerHTML=value);return applied&&invoke(e,e.onchange),applied},this.unset=function(){if(e.length)for(var i=0;i<e.length;++i)e[i].nodeName=="OPTION"?e[i].selected=e[i].defaultSelected:e[i].type=="radio"||e[i].type=="checkbox"?e[i].checked=e[i].defaultChecked:e.value=e.defaultValue;else defined(e.defaultValue)?e.value=e.defaultValue:defined(e.defaultChecked)?e.checked=e.defaultChecked:defined(e.defaultSelected)?e.selected=e.defaultSelected:e instanceof HTMLElement&&(e.innerHTML="")},this.getElement=function(){return e}}function ParameterSet(allowContinue,keepTrack_){var allowContinue_=defined(allowContinue)?allowContinue:!0,trackers_=[];this.init=function(tracking){},this.load=function(node,op,cmd,args){},this.finalize=function(){},this.isChanged=function(){return!0},this.allowContinue=function(flag){allowContinue_=flag},this.isContinueAllowed=function(){return allowContinue_},this.getParameter=function(name){return undefined},this.getParameters=function(){return undefined},this.setInvalid=function(name,message){return _nope_},this.keepTrack=function(flag){keepTrack_=flag},this.isTracking=function(op,cmd,args){return keepTrack_},this.setupTracker=function(tracker,op,cmd,args){trackers_.push(tracker);switch(op){case"command":tracker.Command(cmd,args,this);break;case"config":tracker.Config(cmd,args,this)}},this.isTrackedBy=function(tracker){return trackers_.indexOf(tracker)!=-1},this.stopTracking=function(tracker){tracker?this.isTrackedBy(tracker)&&trackers_.splice(trackers_.indexOf(tracker),1):trackers_=[]},this.focus=function(){},this.clone=function(target){console.log(this.constructor.name+" is not clonable.")}}function MemorySet(selector){ParameterSet.call(this),this.init=function(){this.value=undefined,this.values=new Array},this.load=function(node){var n=selectNode(node,selector);n&&(n.firstChild&&n.childNodes.length==1&&n.firstChild.nodeType==3?this.value=n.firstChild.nodeValue:this.value=n,this.values.push(this.value))}}MemorySet.prototype=new ParameterSet;function FieldSet(fields,allowContinue,keepTrack){var fields_=fields||{};ParameterSet.call(this,allowContinue,keepTrack),this.getField=function(name){return fields_[name]},this.addField=function(name,element){fields_[name]=element},this.getParameter=function(name){return fields_[name]?htmlspecialchars((new FieldValue(fields_[name])).get()):(_DEBUG&&defined(name)&&console.log("Debug: The field is possibly missing: "+name),undefined)},this.getParameters=function(skipNulls){var empty=!0,ret={};for(var f in fields_)if((val=this.getParameter(f))||!skipNulls)empty=!1,ret[f]=val;return empty?undefined:ret},this.setParameter=function(name,value){if(f=fields_[name]){_DEBUG&&(f.type=="radio"||f.type=="checkbox")&&console.log("Debug: Implicitly сalled set("+value+") on "+f.type+' "'+f.name+'"');if(f.nodeName=="SELECT"){var l=new List(f);while(!l.set(value)&&value)l.addValue(value,value)}else(new FieldValue(f)).set(value)}},this.setParameters=function(params){for(var p in params)this.setParameter(p,params[p])},this.setDisabled=function(name,state){if(fields_[name].length&&fields_[name].nodeName!="SELECT")for(var i=0;i<fields_[name].length;++i)fields_[name][i].disabled=state;else fields_[name].disabled=state},this.setInvalid=function(name,message){return Hooks.setInvalid(fields_[name],message)},this.setBusy=function(tracking,cached){if(!ajax._div){var div=ajax._div=document.createElement("div");div.className="hidden",document.body.appendChild(div),div.onmousedown=function(){this.parentNode.removeChild(this)}}tracking||(ajax._div.className="total_busy")},this.init=function(tracking){for(var f in fields_)fields_[f]&&fields_[f].type=="checkbox"&&(new FieldValue(fields_[f])).unset()},this.load=function(node){node.firstChild&&node.firstChild.nodeType==3&&this.setParameter(node.nodeName,node.firstChild.nodeValue);for(var n=0;n<node.childNodes.length;n++){var childNode=node.childNodes[n];childNode.nodeType==1&&this.setParameter(childNode.nodeName,childNode.firstChild?childNode.firstChild.nodeValue:undefined)}},this.save=function(packet,cmd,fields){if(arguments.length==0){var packets={};for(var f in fields_){var command=fields_[f].getAttribute("ndm:command");if(command){var p=fields_[f].getAttribute("ndm:packet")||0;packets[p]||(packets[p]={}),packets[p][command]||(packets[p][command]={}),!this.getParameter(f)&&fields_[f].getAttribute("ndm:send-no-if-empty")?packets[p][command].no="no":packets[p][command][f]=this.getParameter(f)}}var packet=new Packet;for(var p in packets)for(var c in packets[p])(eval(p)||packet).Command(c,packets[p][c],this);packet.proceed()}else{var args=arguments.length>2?{no:"no"}:this.getParameters(!0);for(var i=2;i<arguments.length;i++)this.getParameter(arguments[i])&&(delete args.no,args[arguments[i]]="");packet.Command(cmd,args||{no:"no"},this)}},this.focus=function(field){try{if(fields_[field])fields_[field].focus();else for(var f in fields_){fields_[f].focus();return}}catch(e){}}}FieldSet.prototype=new ParameterSet;function Form(form,allowContinue,keepTrack){var changed_=!1;function reset_(){form.reset(),invoke(form,form.onreset)}var p=new Packet,fields_={};for(var i=0;i<form.length;i++){var e=form.elements[i];if(e.type=="radio")fields_[e.name]||(fields_[e.name]=new Array),fields_[e.name].push(e);else if(e.name&&e.type!="button"&&e.type!="submit"&&e.type!="reset"){fields_[e.name]=e;var command=e.getAttribute("ndm:command");command&&(eval(e.getAttribute("ndm:packet"))||p).Config(command,null,new function(){ParameterSet.call(this),this.target=fields_[e.name],this.load=function(node){(new FieldValue(this.target)).set(getNodeValue(node,this.target.name))}})}}p.proceed(),FieldSet.call(this,fields_,allowContinue,keepTrack);var onchange_=form.onchange;form.onchange=function(){typeof onchange_=="function"&&onchange_(),changed_=!0},form.onkeyup=function(e){e&&e.keyCode==27&&reset_()},this.getElement=function(){return form},this.clone=function(target){var ssfx="_s6c7";"_patched"in form||(function preprocessIds_(e){e.id&&(e.id+=ssfx);for(var i=e.firstChild;i;i=i.nextSibling)i.nodeType==1&&preprocessIds_(i)}(form),form._patched=!0);var f=form.cloneNode(!0);return function processIds_(e){e.id&&e.id.indexOf(ssfx)&&(e.id=e.id.replace(ssfx,""));for(var i=e.firstChild;i;i=i.nextSibling)i.nodeType==1&&processIds_(i)}(f),target.appendChild(f),new Form(f)},this.isChanged=function(){return changed_},this.reset=function(){reset_()}}Form.prototype=new FieldSet;function Trigger(trigger,switchCondition){var condition_=switchCondition||{tag:"enabled"};ParameterSet.call(this),this.isEnabled=function(){return defined(trigger.checked)?trigger.checked:trigger.selected};var loadedValue_=this.isEnabled();this.setEnabled=function(flag){invoke(this,this.onBeforeChange,flag)!=0&&(defined(trigger.checked)&&trigger.checked!=flag&&(trigger.checked=flag,invoke(trigger,trigger.onchange)),defined(trigger.selected)&&trigger.selected!=flag&&(trigger.selected=flag,trigger.parentNode.nodeName=="SELECT"&&invoke(trigger.parentNode,trigger.parentNode.onchange)))},this.and=function(condition){var t=new Trigger(trigger,condition);return t.onBeforeChange=function(newValue){return newValue==0||!!loadedValue_},t},this.getElement=function(){return trigger},this.init=function(tracking){loadedValue_=!1,this.setEnabled(!1)},this.load=function(node,op,cmd,args){(tags=node.getElementsByTagName(condition_.tag)).length!=0&&(!condition_.hasValue||(getNodeValue(node,condition_.tag)||"").match(condition_.hasValue))&&(loadedValue_=!0,this.setEnabled(!0))},this.save=function(packet,cmd,args){this.isEnabled()?packet.Command(cmd,args):packet.No(cmd,args)},this.isChanged=function(){return this.isEnabled()!=loadedValue_},this.focus=function(){trigger.focus()}}Trigger.prototype=new ParameterSet;function List(list,key,name,value){var thisObject=this;function processNode_(node){var option={};if(node.firstChild){var option_text=null;name?option_text=getNodeValue(node,name)||node.getAttribute(name):option_text=node.firstChild.nodeValue,option_text&&(option.text=option_text);var option_value=null;value?option_value=getNodeValue(node,value)||node.getAttribute(value):option_value=option_text,option_value&&(option.value=option_value),invoke(thisObject,thisObject.onBeforeAdd,option,option_text,option_value,node)!=0&&thisObject.addOption(option)}}ParameterSet.call(this),FieldValue.call(this,list),this.clear=function(){list.innerHTML=""},this.addOption=function(option){list.options[list.options.length]=new Option(option.text,option.value)},this.addValue=function(text,value){this.addOption({text:text,value:value})},this.removeOption=function(value){for(var i=0;i<list.options.length;++i)list.options[i].value==value&&list.remove(i)},this.load=function(node){if(node.nodeName==key)processNode_(node);else{var keys=node.getElementsByTagName(key);for(var k=0;k<keys.length;++k)processNode_(keys[k])}},this.sort=function(fn){var selectedIndex=list.selectedIndex,selected=list.options[selectedIndex],sorted=qsort(list.options,fn);list.innerHTML="";for(var i=0,il=sorted.length;i<il;++i)this.addOption(sorted[i]),sorted[i]==selected&&(selectedIndex=list.options.length-1);list.selectedIndex=selectedIndex}}List.prototype=new ParameterSet;function IfList(list){var descByName_=new Array;List.call(this,list,"interface","description","name"),this.doFilter=function(node){var type=getNodeValue(node,"type")||"",index=getNodeValue(node,"index")||0,is_globalable=getNodeValue(node,"global")||!1;return is_globalable&&(type.indexOf("AccessPoint")<0||index<=1)},this.onBeforeAdd=function(option,name,value,node){if(!this.doFilter(node)||!option)return!1;option.text=descByName_[option.value]=name?[name," (",value,")"].join(""):value},this.getDescription=function(name){return descByName_[name]}}function Table(table,allowContinue,keepTrack){var rowDef_,showCols_,groupBy_,groupPrefix_,groups_,filterBy_,selected_,editorForm_,editorFormSrc_,tbody_,keepWidth_,tracking_=!1,cursor_=0;function newGroup_(id,description){if(!groups_[id]){groups_[id]=tbody_.insertRow(-1);var c=groups_[id].insertCell(-1);c.colSpan=table.__width,c.className="section";var h1=document.createElement("h1");h1.innerHTML=description,c.appendChild(h1),++groups_.length}return groups_[id].sectionRowIndex+1}function findPlace_(def,row){if(groupBy_){if(row[groupBy_])return newGroup_(row[groupBy_],groupPrefix_?groupPrefix_+row[groupBy_]:null)}else if(typeof this.compare=="function"){var h=tbody_.rows.length;for(var l=0;l<h;){var m=Math.floor((l+h)/2);this.compare(tbody_.rows[m].__values||{},row)>0?l=m+1:h=m}return h}return def}function parseNode_(node,args){var values=args?new Clone(args):{},langs={};node.firstChild&&node.firstChild.nodeType==3&&(values[node.nodeName]=node.firstChild.nodeValue);for(var a=0;a<node.attributes.length;a++)values[node.attributes[a].name]=node.attributes[a].value;for(var childNode=node.firstChild;childNode;childNode=childNode.nextSibling)if(childNode.nodeType==1){if(lang_){var langAttr=childNode.getAttribute("lang");if(!langAttr&&langs[childNode.nodeName]==lang_||langAttr&&langAttr!=lang_)continue;langs[childNode.nodeName]=langAttr}values[childNode.nodeName]=childNode.firstChild?childNode.firstChild.nodeValue:""}var compare_=typeof this.compare=="function"?this.compare:function(a,b){return equals(a,b)?0:-1};if(!filterBy_||filterBy_(values)){var row;tracking_&&(row=this.forEach(function(v){return compare_(values,v)==0},!0))&&!row.__updated&&row.sectionRowIndex==findPlace_.call(this,Math.max(row.sectionRowIndex,cursor_),values)?(this.setRowValues(row,values),cursor_=row.sectionRowIndex+1):(row=this.insertRow(values,cursor_),cursor_++),row.__updated=tracking_,row.__lastChange={Loaded:!0}}}function stopEditing_(){table.__selected&&(table.__selected.className=table.__selected.__defClassName,table.__editorRow&&(invoke(table.__object,Hooks.tblHideEditor,table.__editorRow.firstChild),invoke(table.__object,Hooks.tblPlaceholderDelete,table.__editorRow)||table.deleteRow(table.__editorRow.rowIndex)))}function clearSelected_(){table.__editorRow=null,table.__object=null;if(table.__selected){var element=table.rows[table.__selected.rowIndex];selected_=table.__selected=null,invoke(element.__object,element.__object.onStopEdit,element),element.__lastChange={Edited:!0}}}function toggleEditing_(event){if(event=event||window.event)event.stopPropagation?event.stopPropagation():event.cancelBubble=!0;stopEditing_();if(table.__selected!=this){clearSelected_(),this.className=this.__defClassName+" highlight",table.__selected=selected_=this;if(invoke(this.__object,this.__object.onBeforeEdit,this)!=0){if(editorFormSrc_){table.__editorRow=invoke(this.__object,Hooks.tblPlaceholderSet);if(table.__editorRow)table.__editorRow.__values=this.__values,editorForm_=this.__object.drawEditorForm(table.__editorRow,this.__values,editorFormSrc_);else{table.__editorRow=document.createElement("tr"),table.__editorRow.__values=this.__values,this.__object.getElement().insertBefore(table.__editorRow,this.nextSibling);var c=table.__editorRow.insertCell(0);c.className="editor",c.colSpan=table.__width,editorForm_=this.__object.drawEditorForm(c,this.__values,editorFormSrc_)}invoke(this.__object,Hooks.tblShowEditor,invoke(editorForm_,editorForm_.getElement),editorFormSrc_),table.__object=this.__object}invoke(this.__object,this.__object.onStartEdit,this,editorForm_)}}else clearSelected_()}function stubRow_(stub,value){var row=stub&&stub==tbody_.rows[stub.sectionRowIndex]?stub:tbody_.insertRow(-1),cell=row.cells.length?row.cells[0]:row.insertCell(-1);return cell.colSpan=table.__width||1,cell.innerHTML=value,row}function render_(e){var cols=showCols_ instanceof Object?showCols_:e.__values;for(var j in cols)if(defined(e.__values[j])){var w=0;for(var i in cols){++w;var cell=e.insertCell(e.cells.length);cell.className="col_"+i,cell.onclick=function(event){toggleEditing_.call(e,event)};if(keepWidth_){var div=document.createElement("div");div.style.overflow="hidden",div.style.margin=div.style.padding=0,cell.appendChild(div),div.style.width=div.offsetWidth+"px",e.__object.drawCell(div,e.__values[i],i,e)}else e.__object.drawCell(cell,e.__values[i],i,e)}if(!table.__width||w>table.__width)table.__width=w;return}stubRow_(e,l10n(65536,"(empty)")).onclick=toggleEditing_}ParameterSet.call(this,allowContinue,keepTrack),this.init=function(tracking){!(tracking_=tracking)&&(!tbody_||tbody_.rows.length!=0)&&(this.destroy(),tbody_=document.createElement("tbody"),table.appendChild(tbody_),invoke(this,this.onChange))},this.destroy=function(){this.stopEditing(),tbody_&&table.removeChild(tbody_),groups_={length:0}},this.isEmpty=function(){var e=this.getElement();return e.rows.length==0||e.rows.length==1&&e.rows[0]==this.stub},this.onChange=function(element){this.isEmpty()?this.stub=stubRow_(this.stub,l10n(65537,"(empty)")):this.stub&&(tbody_.removeChild(this.stub),delete this.stub)},this.setBusy=function(tracking,cached){!tracking&&this.isEmpty()&&(this.stub=stubRow_(this.stub,'<img src="/a/loading-char.gif" width="14" height="14"/>'))},this.drawCell=function(element,value,col,row){element.innerHTML=htmlspecialchars(value)||"&nbsp;",keepWidth_&&(element.title=element.innerHTML)},this.drawEditorForm=function(target,values,editorFormSrc){this.stopTracking();var editorForm=editorFormSrc.clone(target);return editorForm.setParameters(values),editorForm.focus(),editorForm},this.defineRow=function(def){rowDef_=def},this.showColumns=function(col){showCols_={},table.__width||(table.__width=arguments.length);for(var i=0;i<arguments.length;i++)showCols_[arguments[i]]=!0},this.keepWidth=function(flag){keepWidth_=flag},this.setEditorForm=function(form){editorFormSrc_=form},this.getEditorForm=function(){return editorForm_},this.startEditing=function(element){toggleEditing_.call(element)},this.stopEditing=function(){stopEditing_(),clearSelected_()},this.groupBy=function(col,prefix){groupBy_=col,groupPrefix_=prefix},this.filterBy=function(predicate){filterBy_=predicate},this.forEach=function(op,includeOutdated){var rows=this.getElement().rows;for(var pos=0,rlen=rows.length;pos<rlen;++pos){var row=rows[pos];if(row!=table.__editorRow&&row.__values&&(!tracking_||includeOutdated||row.__updated)&&op(row.__values,row==selected_))return row}return},this.find=function(searchVals){return this.forEach(function(values,isSelected){for(var v in searchVals)if((searchVals[v]||values[v])&&searchVals[v]!=values[v])return!1;return!0})},this.reorder=function(){if(this.getElement()){this.stopEditing();var oldbody=tbody_;table.appendChild(tbody_=document.createElement("tbody"));for(var pos in oldbody.rows){var row=oldbody.rows[pos];if(row!=table.__editorRow&&row.__values){var newRow=this.insertRow(row.__values);newRow.__lastChange=row.__lastChange,this.setClassName(newRow,row.__defClassName)}}table.removeChild(oldbody),invoke(this,this.onChange)}},this.insertRow=function(row,pos,defClassName){if(!filterBy_||filterBy_(row)){var h=findPlace_.call(this,isNaN(pos)?-1:pos,row||{}),e=this.getElement().insertRow(h);return e.__defClassName=defClassName||"",e.__object=this,e.className=e.__defClassName,e.onmouseover=function(){this.className=this.__defClassName+" highlight"},e.onmouseout=function(){this!=table.__selected&&(this.className=this.__defClassName)},this.setRowValues(e,row||{}),e.__lastChange={Inserted:!0},invoke(this,this.onChange,e),e}return!1},this.deleteRow=function(element){selected_==element&&this.stopEditing();try{this.getElement().removeChild(element),invoke(this,this.onChange)}catch(e){}},this.getSelectedRow=function(){return selected_?this.getElement().rows[selected_.sectionRowIndex]:undefined},this.getRowValues=function(element){return element.__values},this.getElement=function(){return defined(tbody_)||this.init(),tbody_},this.setClassName=function(element,className){element.__defClassName=element.className=className},this.setRowValues=function(element,values){if(!element.__values||!equals(element.__values,values||{})){element.__values=values,invoke(this,this.onRowChange,element,values),element.__lastChange={Changed:!0},selected_==element&&editorForm_&&editorForm_.setParameters(values);while(element.firstChild)element.removeChild(element.firstChild);render_(element);return}},this.mergeRowValues=function(element,values){for(var v in element.__values)v in values||(values[v]=element.__values[v]);this.setRowValues(element,values)},this.load=function(node,op,cmd,args){if(!rowDef_||node.nodeName==rowDef_)parseNode_.call(this,node,args);else{var nodeList=node.getElementsByTagName(rowDef_);for(var i=0;i<nodeList.length;++i)parseNode_.call(this,nodeList[i],args)}},this.finalize=function(){var e=this.getElement();cursor_=0;if(tracking_)for(var r=0;r<e.rows.length;)e.rows[r].__values&&e.rows[r]!=table.__editorRow&&!e.rows[r].__updated?this.deleteRow(e.rows[r]):(e.rows[r].__updated=!1,r++);tracking_=!1}}Table.prototype=new ParameterSet;function Packet(agent,noCache){var requestXml_=new Array,queue_=new Array;this.trackingInterval_=5e3;var error_=!1,thisObject=this,agent_=agent,xhr_=null;function renderResponse_(data,logger,queueEntry){var pSet=queueEntry.pSet,progress=-1,continued=!1;function messageFromNode_(node){var args=new Array;for(var n=0,nodes=node.getElementsByTagName("argument");n<nodes.length;++n)args.push(nodes[n].firstChild&&nodes[n].firstChild.nodeType==3?nodes[n].firstChild.nodeValue:"");return l10n(node.getAttribute("code"),node.firstChild?node.firstChild.nodeValue:"",args)}function printMessage_(node,logger){if(logger){var el=document.createElement("div");el.className=node.nodeName,el.innerHTML=messageFromNode_(node).replace(/(?:^[\r\n\s]+|[\r\n\s]+$)/g,"")+(progress>=0?" ("+progress+"%)":""),logger.appendChild(el),$a(logger).show(1),logger.locked=!0,logger.timeout&&clearTimeout(logger.timeout),logger.timeout=setTimeout(function(){logger.locked=!1,delete logger.timeout},5e3),el.scrollIntoView(!1)}}for(var i=0;i<data.childNodes.length;i++){var printable=!0;switch((node=data.childNodes[i]).nodeName){case"error":if(node.getAttribute("code")==268369921)break;error_=!0;if(pSet){pSet.stopTracking(),printable=invoke(pSet,pSet.handleError,node.getAttribute("code"),node)!=0;if(node.getAttribute("source")){pSet.setInvalid(node.getAttribute("source"),messageFromNode_(node));break}}"cached"in queueEntry||(printable&=invoke(thisObject,thisObject.handleError,node.getAttribute("code"),node)!=0,printable&&printMessage_(node,logger));break;case"message":if(node.getAttribute("code")==268370045)break;pSet&&(printable=invoke(pSet,pSet.handleMessage,node.getAttribute("code"),node)!=0),"cached"in queueEntry||(printable&=invoke(thisObject,thisObject.handleMessage,node.getAttribute("code"),node)!=0,printable&&printMessage_(node,logger));break;case"progress":progress=node.firstChild?node.firstChild.nodeValue:0,invoke(thisObject,thisObject.onProgress,progress,node.getAttribute("name"),i);break;case"reboot":"onReboot"in thisObject?invoke(thisObject,thisObject.onReboot):alert(l10n(65538,"The device is going to reboot. Webadmin will be inaccessible for a moment."));break;case"continued":continued=!0;break;case"prompt":"onPrompt"in thisObject&&invoke(thisObject,thisObject.onPrompt);break;default:pSet&&node.nodeType==1&&pSet.load(node,queueEntry.op,queueEntry.name,queueEntry.args)}}continued?(pSet&&!pSet.isContinueAllowed()&&continuer.stop(pSet),continuer.onProgress=thisObject.onProgress,continuer.handleError=thisObject.handleError,continuer.handleMessage=thisObject.handleMessage,"onPrompt"in thisObject&&(continuer.onPrompt=thisObject.onPrompt),"onReboot"in thisObject&&(continuer.onReboot=thisObject.onReboot),continuer.schedule(logger,pSet,1e3),pSet&&invoke(pSet,pSet.setBusy,thisObject.__isTracker,!1)):(progress!=100&&invoke(thisObject,thisObject.onProgress,100),pSet&&(queueEntry.needFinalize=!0))}function request_(op,name,args,pSet,skipNulls){var entry={op:op,pSet:pSet,name:name,args:args};if(!noCache)for(var i=0;i<queue_.length;++i)if(queue_[i].op==op&&queue_[i].name==name&&equals(queue_[i].args,args)){entry.cached=i;break}var id=queue_.push(entry)-1;if(!defined(entry.cached)){requestXml_.push("<request",agent_?' agent="'+agent_+'"':"",' id="',id,'"><',op,' name="',name,'"');if(args){requestXml_.push(">");for(var p in args)if(p){var v=htmlspecialchars(op=="command"&&pSet&&pSet.getParameter(p)?pSet.getParameter(p):args[p]);(v||!skipNulls)&&requestXml_.push("<",p,v?">"+v+"</"+p+">":"/>")}requestXml_.push("</",op,">")}else requestXml_.push("/>");requestXml_.push("</request>")}}this.No=function(name,args,pSet,skipNulls){args&&(args.no="no"),this.Command(name,args||{no:"no"},pSet,skipNulls)},this.ConfigSave=function(){this.Command("system config-save")},this.Command=function(name,args,pSet,skipNulls){request_("command",name,args,pSet,skipNulls)},this.Config=function(name,args,pSet){request_("config",name,args,pSet)},this.Continue=function(pSet){requestXml_.push('<request id="',queue_.push({op:"continue",pSet:pSet})-1,'"><continue/></request>')},this.Break=function(pSet){requestXml_.push('<request id="',queue_.push({op:"break",pSet:pSet})-1,'"><break/></request>')},this.flushTo=function(packet){for(var i=0;i<queue_.length;++i){var q=queue_[i];switch(q.op){case"command":packet.Command(q.name,q.args,q.pSet);break;case"config":packet.Config(q.name,q.args,q.pSet);break;case"continue":packet.Continue(q.pSet);break;case"break":packet.Break(q.pSet)}}this.clear()},this.getErrorState=function(){return error_},this.getXml=function(){return requestXml_.join("")},this.clear=function(){requestXml_=new Array,queue_=new Array},this.setTrackingInterval=function(i){this.trackingInterval_=i},this.scheduleTracker=function(tracker,logger){setTimeout(function(){tracker.proceed(logger)},tracker.trackingInterval_)},this.setAgent=function(a){agent_=a},this.proceed=function(logger){if(logger){if(logger===1||logger===!0)logger="logger";typeof logger=="string"&&(logger=document.getElementById(logger))}function _success(data,aj){if(data){var tracker=new Packet;tracker.__isTracker=!0,tracker.onLoad=thisObject.onLoad,tracker.handleError=thisObject.handleError,tracker.handleMessage=thisObject.handleMessage,tracker.setTrackingInterval(thisObject.trackingInterval_),logger&&!logger.locked&&!thisObject.__isTracker&&($a(logger).show(0),defined(logger.__keep)?logger.innerHTML=logger.__keep:logger.__keep=logger.innerHTML);for(var i=0;i<this.queue_.length;i++){var q=this.queue_[i],r=selectNode(data,"response@id="+(defined(q.cached)?q.cached:i));if(r){continuer.clear();if(!thisObject.__isTracker||!q.pSet||q.pSet.isTrackedBy(thisObject))!thisObject.__isContinuer&&q.pSet&&q.pSet.__initialized!=this.stamp&&(q.pSet.init(thisObject.__isTracker),q.pSet.__initialized=this.stamp),renderResponse_(r,logger,q),q.pSet&&q.pSet.isTracking(q.op,q.name,q.args)&&invoke(q.pSet,q.pSet.setupTracker,tracker,q.op,q.name,q.args)}}for(var i=0;i<this.queue_.length;i++){var q=this.queue_[i];thisObject.__isTracker&&q.pSet&&q.pSet.stopTracking(thisObject),q.needFinalize&&q.pSet.__finalized!=this.stamp&&(q.pSet.finalize(),q.pSet.__finalized=this.stamp)}tracker.getXml()&&invoke(thisObject,thisObject.scheduleTracker,tracker,logger)}xhr_=null,invoke(thisObject,thisObject.onLoad)}var context={stamp:(new Date).getTime(),queue_:queue_},timer=setTimeout(function(){timer=null;with(context)for(var i=0;i<queue_.length;i++)queue_[i].pSet&&invoke(queue_[i].pSet,queue_[i].pSet.setBusy,thisObject.__isTracker,!!queue_[i].cached)},300);function onajax(aj){timer!==null&&clearTimeout(timer),_success.call(this,aj.responseXML,aj)}var data=this.getXml();return data?(continuer.clear(),error_=!1,xhr_=ajax.post("/ci",data,onajax,context),this.clear(),!0):!1},this.abort=function(){xhr_&&(xhr_.abort(),xhr_=null)}}function Named(name){var name_=name;Packet.call(this),this.Command_=this.Command,this.Command=function(cmd,args,pSet,skipNulls){name_&&(args&&!args.name&&(args.name=name_),this.Command_(cmd,args||{name:name_},pSet,skipNulls))},this.Config_=this.Config,this.Config=function(cmd,args,pSet,skipNulls){name_&&(args&&!args.name&&(args.name=name_),this.Config_(cmd,args||{name:name_},pSet,skipNulls))},this.setName=function(value){name_=value},this.getName=function(){return name_}}Named.prototype=new Packet;function Interface(ifName){var ip_,dns_,defRoute_,dhcp_,global_,desc_,state_;Named.call(this,ifName),this.create=function(){this.Command("interface")},this.loadIp=function(address,mask){ip_=new FieldSet({address:address,mask:mask}),this.Config("interface ip address",null,ip_)},this.getIp=function(){return ip_.getParameter("address")},this.getMask=function(){return ip_.getParameter("mask")},this.saveIp=function(){ip_.save(this,"interface ip address")},this.loadDns=function(){dns_=arguments,this.Config("ip name-server",{"interface":this.getName()},new function(){ParameterSet.call(this);var i=0;this.load=function(node){i<dns_.length&&(new FieldValue(dns_[i++])).set(getNodeValue(node,"address"))}})},this.saveDns=function(){this.No("ip name-server",{"interface":this.getName()});for(var i=0;i<dns_.length;++i){var address=(new FieldValue(dns_[i])).get();address&&this.Command("ip name-server",{"interface":this.getName(),address:address},new FieldSet({address:dns_[i]}))}},this.loadDefaultRoute=function(gateway){defRoute_=new FieldSet({gateway:gateway}),this.Config("ip route",{"interface":ifName,"default":""},defRoute_)},this.getDefaultRoute=function(){return defRoute_.getParameter("gateway")},this.saveDefaultRoute=function(){this.getDefaultRoute()?this.Command("ip route",{"interface":ifName,"default":"",gateway:""},defRoute_):this.No("ip route",{"interface":ifName,"default":""})},this.loadDhcpState=function(trigger){dhcp_=new Trigger(trigger),this.Config("interface ip address dhcp",null,dhcp_)},this.isDhcpEnabled=function(){return dhcp_&&dhcp_.isEnabled()},this.saveDhcpState=function(){dhcp_.save(this,"interface ip address dhcp")},this.loadPriority=function(priority){global_=new FieldSet({priority:priority}),this.Config("interface ip global",null,global_)},this.getPriority=function(){return global_&&global_.getParameter("priority")},this.savePriority=function(){global_.getParameter("priority")?this.Command("interface ip global",global_.getParameters(),global_):this.No("interface ip global")},this.loadDescription=function(desc){desc_=new FieldSet({description:desc}),this.Config("interface description",null,desc_)},this.getDescription=function(){return desc_.getParameter("description")},this.saveDescription=function(){this.Command("interface description",desc_.getParameters(),desc_)},this.loadState=function(trigger){state_=new Trigger(trigger),this.Config("interface up",null,state_)},this.isEnabled=function(){return state_&&state_.isEnabled()},this.saveState=function(){state_.save(this,"interface up")}}Interface.prototype=new Named;function loadPassword(element,value){value&&(element.value="",element.onblur=function(){this.value||(this.value=l10n(65700,"(click to edit element)"),this.className="greyed-out")},element.onchange=function(){this.className=="greyed-out"&&(this.className="")},element.onfocus=function(){this.className=="greyed-out"&&(this.value=this.className="")},element.value="",element.onblur())}function getPassword(element){return element.className!="greyed-out"?element.value:!1}function PPP(ifName){var connect_,via_,identity_,password_,auth_,mppe_,adjustMss_,peer_,service_;Interface.call(this,ifName),this.loadConnectState=function(trigger,via){connect_=new Trigger(trigger),via_=new FieldSet({via:via}),this.Config("interface connect",null,connect_),this.Config("interface connect",null,via_),this.Config("interface up",null,connect_.and())},this.isConnecting=function(){return connect_.isEnabled()},this.saveConnectState=function(){this.isConnecting()?(this.Command("interface up"),this.Command("interface connect",{via:""},via_,!0)):(this.Command("interface down"),this.No("interface connect"))},this.loadCredentials=function(identity,password){this.Config("interface authentication identity",null,identity_=new FieldSet({identity:identity})),this.Config("interface authentication password",null,password_=new function(){FieldSet.call(this,{password:password}),this.load=function(node){loadPassword(password,getNodeValue(node,"password"))},this.save_=this.save,this.save=function(packet,cmd){getPassword(password)&&this.save_(packet,cmd)}})},this.saveCredentials=function(){identity_.save(this,"interface authentication identity"),password_.save(this,"interface authentication password")},this.loadAuthMode=function(pap,chap,mschap,mschapv2,mixed){auth_={},pap&&(auth_.pap=new Trigger(pap)),chap&&(auth_.chap=new Trigger(chap)),mschap&&(auth_.mschap=new Trigger(mschap)),mschapv2&&(auth_["mschap-v2"]=new Trigger(mschapv2));var i=0,tmixed=mixed?new Trigger(mixed):null;for(var mode in auth_)tmixed&&(auth_[mode].onBeforeChange=function(newValue){var ismixed=newValue&&++i>1;return tmixed.setEnabled(ismixed),!ismixed}),this.Config("interface authentication "+mode,null,auth_[mode])},this.saveAuthMode=function(){for(var mode in auth_)auth_[mode].save(this,"interface authentication "+mode)},this.loadMppeState=function(trigger){mppe_=new Trigger(trigger),this.Config("interface encryption mppe",null,mppe_)},this.isMppeEnabled=function(){return mppe_&&mppe_.isEnabled()},this.saveMppeState=function(){mppe_.save(this,"interface encryption mppe")},this.loadAdjustMssState=function(trigger){adjustMss_=new Trigger(trigger,{tag:"pmtu"}),this.Config("interface ip tcp adjust-mss",null,adjustMss_)},this.isAdjustMssEnabled=function(){return adjustMss_&&adjustMss_.isEnabled()},this.saveAdjustMssState=function(){adjustMss_.save(this,"interface ip tcp adjust-mss",{pmtu:0})},this.loadPeer=function(peer){this.Config("interface peer",null,peer_=new FieldSet({peer:peer}))},this.getPeer=function(){return peer_.getParameter("peer")},this.savePeer=function(){peer_.save(this,"interface peer")},this.loadService=function(service){this.Config("interface service",null,service_=new FieldSet({service:service}))},this.getService=function(){return service_.getParameter("service")},this.saveService=function(){service_.save(this,"interface service")}}PPP.prototype=new Interface